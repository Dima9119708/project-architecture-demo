import{n as y,r as m,o as T,j as e,ag as le,ah as de,ai as ue,aj as me,ak as O,al as pe,B as g,c as L,u as U,P as S,a as N,b as xe,am as he,an as je,ao as ve,f as fe,l as V,ap as ge,q as Re}from"./index-DVKJeCGz.js";import{b as be,u as _,a as Ce,c as K,C as R,d as ye,F as Ie}from"./index.esm-DkR1U_Lv.js";import{c as A,d as E,e as M,g as b,i as q,j as D,l as C}from"./header-page-Igirg9qS.js";import{u as $,a as Ne,D as we,b as Se,c as Fe}from"./index-CPyZUZwB.js";import{P as z}from"./plus-B-JMe3Lr.js";import{L as G,I as F}from"./main-page-0Xmgnz8E.js";import{c as H,R as ke,I as Pe}from"./index-B7vNr7oS.js";import{C as _e}from"./circle-_zs4U1dq.js";import{L as Ae,a as Ee}from"./lock-Dn86efg6.js";import"./eye-CwaGsnZ3.js";import"./chevron-right-CX0OFrr9.js";import"./badge-n0FBi3u5.js";import"./pencil-D0opHlNi.js";import"./trash-2-DC24fpnG.js";const Me="manage-roles",qe=()=>({queryKey:[Me],queryFn:()=>y.getManageRoles()}),De=r=>{const{className:a,onChange:s,value:o,error:t}=r,[i,u]=m.useState(!1),{data:c,isPending:d}=T({...qe(),enabled:i});return e.jsxs(le,{error:t,onOpenChange:u,onValueChange:l=>{const n=c==null?void 0:c.find(p=>p.id===l);n&&s(n)},children:[e.jsx(de,{className:a,isError:!!t,children:e.jsx(ue,{placeholder:(o==null?void 0:o.name)||"Role..."})}),e.jsxs(me,{children:[d&&Array.from({length:5},(l,n)=>e.jsx(O,{className:"h-[1.5rem] mb-[0.2rem] rounded"},n)),c==null?void 0:c.map(l=>e.jsx(pe,{value:l.id,onClick:()=>s(l),children:l.name},l.id))]})]})},Q=m.createContext({}),I=()=>m.useContext(Q),B=r=>{const{fields:a,append:s,prepend:o,remove:t,swap:i,move:u,insert:c,replace:d,update:l}=be({name:r.name}),n=m.useMemo(()=>({append:s,prepend:o,remove:t,swap:i,move:u,insert:c,replace:d,update:l}),[s,o,t,i,u,c,d,l]);return e.jsx(Q.Provider,{value:n,children:r.children({fields:a})})},Ge=()=>{const r=$(),a=m.useRef(null),s=Ne(),o=!!r,t=_({mutationFn:n=>y.createBoard(n),onSuccess:async()=>{var n;await s(),(n=a.current)==null||n.click()}}),i=_({mutationFn:n=>y.updateBoard({id:r,...n}),onSuccess:async()=>{var n;await s(),(n=a.current)==null||n.click()}}),{data:u,isPending:c}=T({queryKey:["manage-board",r],queryFn:async()=>{const n=await y.getBoard(r);return{title:n.title,description:n.description??"",columns:n.columns,project_access:n.project_access,board_access:n.board_access}},gcTime:0,enabled:o}),d=Ce({mode:"onChange",defaultValues:{title:"",description:"",project_access:[{user:void 0,role:void 0}],board_access:"open",columns:[{title:"TODO"},{title:"IN PROGRESS"},{title:"DONE"}]},values:u}),l=m.useCallback(n=>{o?i.mutate(n):t.mutate(n)},[t,o,i]);return{methodsForm:d,isPending:c,onSubmit:l,closeButtonRef:a,isMutating:t.isPending||i.isPending}},Be=r=>{const{append:a}=I(),{trigger:s}=K();return e.jsxs(g,{variant:"outline",onClick:async()=>{const o=`columns.${r.lastIndex}.title`;await s([o])&&a({})},children:[e.jsx(z,{}),"Add"]})},Te=r=>{const{append:a}=I(),{trigger:s}=K();return e.jsxs(g,{variant:"outline",onClick:async()=>{const o=`project_access.${r.lastIndex}.user`,t=`project_access.${r.lastIndex}.role`;await s([o,t])&&a({})},children:[e.jsx(z,{}),"Add"]})};var k="Radio",[Oe,W]=L(k),[Le,Ue]=Oe(k),X=m.forwardRef((r,a)=>{const{__scopeRadio:s,name:o,checked:t=!1,required:i,disabled:u,value:c="on",onCheck:d,form:l,...n}=r,[p,h]=m.useState(null),x=U(a,f=>h(f)),j=m.useRef(!1),v=p?l||!!p.closest("form"):!0;return e.jsxs(Le,{scope:s,checked:t,disabled:u,children:[e.jsx(S.button,{type:"button",role:"radio","aria-checked":t,"data-state":Z(t),"data-disabled":u?"":void 0,disabled:u,value:c,...n,ref:x,onClick:N(r.onClick,f=>{t||d==null||d(),v&&(j.current=f.isPropagationStopped(),j.current||f.stopPropagation())})}),v&&e.jsx(Ve,{control:p,bubbles:!j.current,name:o,value:c,checked:t,required:i,disabled:u,form:l,style:{transform:"translateX(-100%)"}})]})});X.displayName=k;var Y="RadioIndicator",J=m.forwardRef((r,a)=>{const{__scopeRadio:s,forceMount:o,...t}=r,i=Ue(Y,s);return e.jsx(xe,{present:o||i.checked,children:e.jsx(S.span,{"data-state":Z(i.checked),"data-disabled":i.disabled?"":void 0,...t,ref:a})})});J.displayName=Y;var Ve=r=>{const{control:a,checked:s,bubbles:o=!0,...t}=r,i=m.useRef(null),u=he(s),c=je(a);return m.useEffect(()=>{const d=i.current,l=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(l,"checked").set;if(u!==s&&p){const h=new Event("click",{bubbles:o});p.call(d,s),d.dispatchEvent(h)}},[u,s,o]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:s,...t,tabIndex:-1,ref:i,style:{...r.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Z(r){return r?"checked":"unchecked"}var Ke=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],P="RadioGroup",[$e,gr]=L(P,[H,W]),ee=H(),re=W(),[ze,He]=$e(P),se=m.forwardRef((r,a)=>{const{__scopeRadioGroup:s,name:o,defaultValue:t,value:i,required:u=!1,disabled:c=!1,orientation:d,dir:l,loop:n=!0,onValueChange:p,...h}=r,x=ee(s),j=ve(l),[v,f]=fe({prop:i,defaultProp:t,onChange:p});return e.jsx(ze,{scope:s,name:o,required:u,disabled:c,value:v,onValueChange:f,children:e.jsx(ke,{asChild:!0,...x,orientation:d,dir:j,loop:n,children:e.jsx(S.div,{role:"radiogroup","aria-required":u,"aria-orientation":d,"data-disabled":c?"":void 0,dir:j,...h,ref:a})})})});se.displayName=P;var ae="RadioGroupItem",oe=m.forwardRef((r,a)=>{const{__scopeRadioGroup:s,disabled:o,...t}=r,i=He(ae,s),u=i.disabled||o,c=ee(s),d=re(s),l=m.useRef(null),n=U(a,l),p=i.value===t.value,h=m.useRef(!1);return m.useEffect(()=>{const x=v=>{Ke.includes(v.key)&&(h.current=!0)},j=()=>h.current=!1;return document.addEventListener("keydown",x),document.addEventListener("keyup",j),()=>{document.removeEventListener("keydown",x),document.removeEventListener("keyup",j)}},[]),e.jsx(Pe,{asChild:!0,...c,focusable:!u,active:p,children:e.jsx(X,{disabled:u,required:i.required,checked:p,...d,...t,name:i.name,ref:n,onCheck:()=>i.onValueChange(t.value),onKeyDown:N(x=>{x.key==="Enter"&&x.preventDefault()}),onFocus:N(t.onFocus,()=>{var x;h.current&&((x=l.current)==null||x.click())})})})});oe.displayName=ae;var Qe="RadioGroupIndicator",ne=m.forwardRef((r,a)=>{const{__scopeRadioGroup:s,...o}=r,t=re(s);return e.jsx(J,{...t,...o,ref:a})});ne.displayName=Qe;var te=se,ce=oe,We=ne;const ie=m.forwardRef(({className:r,...a},s)=>e.jsx(te,{className:V("grid gap-2",r),...a,ref:s}));ie.displayName=te.displayName;const w=m.forwardRef(({className:r,...a},s)=>e.jsx(ce,{ref:s,className:V("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),...a,children:e.jsx(We,{className:"flex items-center justify-center",children:e.jsx(_e,{className:"h-3.5 w-3.5 fill-primary"})})}));w.displayName=ce.displayName;const Xe=()=>e.jsx(R,{name:"board_access",render:({field:r})=>e.jsxs(ie,{value:r.value,onValueChange:r.onChange,children:[e.jsx("div",{className:"text font-bold",children:"Access"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"open",id:"open"}),e.jsxs(G,{className:"flex items-center gap-x-2",htmlFor:"open",children:[e.jsx(Ae,{className:"h-[1.25rem] w-[1.25rem]"}),"Open"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"private",id:"private"}),e.jsxs(G,{className:"flex items-center gap-x-2",htmlFor:"private",children:[e.jsx(Ee,{className:"h-[1.25rem] w-[1.25rem]"}),"Private"]})]})]})}),Ye=r=>e.jsx(R,{name:r.name,rules:{required:"Column name is required"},render:({field:a,fieldState:s})=>{var o;return e.jsx(F,{value:a.value,onChange:a.onChange,placeholder:"Column name...",error:(o=s.error)==null?void 0:o.message})}}),Je=()=>e.jsx(R,{name:"description",render:({field:r})=>e.jsx("div",{className:"grid gap-2",children:e.jsx(F,{id:"description",type:"text",label:"Description",placeholder:"Description",required:!0,...r})})}),Ze=()=>e.jsx(R,{name:"title",rules:{required:"Title is required"},render:({field:r,fieldState:a})=>{var s;return e.jsx(F,{type:"text",placeholder:"Title",label:"Title",required:!0,...r,error:(s=a.error)==null?void 0:s.message})}}),er=m.memo(Ze),rr=r=>{const{remove:a}=I();return r.isSingle?null:e.jsx(g,{size:"sm",variant:"link",onClick:()=>a(r.index),children:"Remove"})},sr=r=>{const{remove:a}=I();return r.isSingle?null:e.jsx(g,{size:"sm",variant:"link",onClick:()=>a(r.index),children:"Remove"})},ar=r=>!!ye({name:r.formUserName})&&e.jsx(R,{name:r.name,rules:{required:"Role is required"},render:({field:s,fieldState:o})=>{var t;return e.jsx(De,{value:s.value,onChange:s.onChange,error:(t=o.error)==null?void 0:t.message})}}),or=r=>e.jsx(R,{name:r.name,rules:{required:"User is required"},render:({field:a,fieldState:s})=>{var o;return e.jsx(ge,{value:a.value,onChange:a.onChange,error:(o=s.error)==null?void 0:o.message})}}),Rr=()=>{const a=!!$(),{methodsForm:s,isPending:o,onSubmit:t,isMutating:i,closeButtonRef:u}=Ge();return e.jsxs(Ie,{...s,children:[e.jsxs(we,{className:"grid gap-6",children:[a&&o&&Array.from({length:8},(c,d)=>e.jsx(O,{className:"h-[3.5rem] w-full"},d)),(a?!o:!0)&&e.jsxs(e.Fragment,{children:[e.jsx(er,{}),e.jsx(Je,{}),e.jsx(Xe,{}),e.jsx(B,{name:"project_access",children:({fields:c})=>e.jsxs("div",{children:[e.jsx(A,{className:"mb-2 h-auto p-0 shadow-[none]",children:e.jsxs(E,{children:[e.jsxs(M,{children:[e.jsx(b,{className:"w-[50%]",children:"Name"}),e.jsx(b,{className:"w-[50%]",children:"Role"}),e.jsx(b,{className:"min-w-[5rem]"})]}),e.jsx(q,{children:c.map((d,l)=>{const n=`project_access.${l}.user`,p=`project_access.${l}.role`,h=c.length===1;return e.jsxs(D,{id:d.id,children:[e.jsx(C,{children:e.jsx(or,{name:n})}),e.jsx(C,{children:e.jsx(ar,{name:p,formUserName:n})}),e.jsx(C,{children:e.jsx(sr,{index:l,isSingle:h})})]},d.id)})})]})}),e.jsx(Te,{lastIndex:c.length-1})]})}),e.jsx(B,{name:"columns",children:({fields:c})=>e.jsxs("div",{children:[e.jsx("div",{className:"text font-bold",children:"Columns"}),e.jsx(A,{className:"mb-2 h-auto p-0 shadow-[none]",children:e.jsxs(E,{children:[e.jsxs(M,{children:[e.jsx(b,{className:"w-full",children:"Column name"}),e.jsx(b,{className:"min-w-[5rem]"})]}),e.jsx(q,{children:c.map((d,l)=>{const n=`columns.${l}.title`,p=c.length===1;return e.jsxs(D,{id:d.id,children:[e.jsx(C,{children:e.jsx(Ye,{name:n})}),e.jsx(C,{children:e.jsx(rr,{index:l,isSingle:p})})]},d.id)})})]})}),e.jsx(Be,{lastIndex:c.length-1})]})})]})]}),e.jsxs(Se,{children:[e.jsxs(g,{disabled:i,onClick:s.handleSubmit(t),children:[i&&e.jsx(Re,{className:"stroke-white"}),a?"Update":"Create"]}),e.jsx(Fe,{asChild:!0,ref:u,children:e.jsx(g,{variant:"outline",children:"Cancel"})})]})]})};export{Rr as default};
