import{h as y,r as m,u as O,j as e,S as le,i as de,k as ue,l as me,m as T,n as pe,o as xe,p as U,q as he,s as _,v as je,w as L,x as g,P as V,y as K,z as $,A as S,C as I,D as ve,E as fe,F as ge,G as z,H as Re,I as Ce,R as be,J as ye,K as H,L as Ne,M as R,N as A,O as F,Q as Ie,U as we,V as Se,W as Fe,X as E,Y as M,Z as G,_ as C,$ as q,a0 as D,a1 as b,a2 as ke,a3 as Pe,a4 as _e}from"./index-D8EBPATn.js";import{L as Ae,a as Ee}from"./lock-BQ_f8oDY.js";const Me="manage-roles",Ge=()=>({queryKey:[Me],queryFn:()=>y.getManageRoles()}),qe=s=>{const{className:a,onChange:r,value:n,error:t}=s,[i,u]=m.useState(!1),{data:c,isPending:d}=O({...Ge(),enabled:i});return e.jsxs(le,{error:t,onOpenChange:u,onValueChange:l=>{const o=c==null?void 0:c.find(p=>p.id===l);o&&r(o)},children:[e.jsx(de,{className:a,isError:!!t,children:e.jsx(ue,{placeholder:(n==null?void 0:n.name)||"Role..."})}),e.jsxs(me,{children:[d&&Array.from({length:5},(l,o)=>e.jsx(T,{className:"h-[1.5rem] mb-[0.2rem] rounded"},o)),c==null?void 0:c.map(l=>e.jsx(pe,{value:l.id,onClick:()=>r(l),children:l.name},l.id))]})]})},Q=m.createContext({}),N=()=>m.useContext(Q),B=s=>{const{fields:a,append:r,prepend:n,remove:t,swap:i,move:u,insert:c,replace:d,update:l}=xe({name:s.name}),o=m.useMemo(()=>({append:r,prepend:n,remove:t,swap:i,move:u,insert:c,replace:d,update:l}),[r,n,t,i,u,c,d,l]);return e.jsx(Q.Provider,{value:o,children:s.children({fields:a})})},De=()=>{const s=U(),a=m.useRef(null),r=he(),n=!!s,t=_({mutationFn:o=>y.createBoard(o),onSuccess:async()=>{var o;await r(),(o=a.current)==null||o.click()}}),i=_({mutationFn:o=>y.updateBoard({id:s,...o}),onSuccess:async()=>{var o;await r(),(o=a.current)==null||o.click()}}),{data:u,isPending:c}=O({queryKey:["manage-board",s],queryFn:async()=>{const o=await y.getBoard(s);return{title:o.title,description:o.description??"",columns:o.columns,project_access:o.project_access,board_access:o.board_access}},gcTime:0,enabled:n}),d=je({mode:"onChange",defaultValues:{title:"",description:"",project_access:[{user:void 0,role:void 0}],board_access:"open",columns:[{title:"TODO"},{title:"IN PROGRESS"},{title:"DONE"}]},values:u}),l=m.useCallback(o=>{n?i.mutate(o):t.mutate(o)},[t,n,i]);return{methodsForm:d,isPending:c,onSubmit:l,closeButtonRef:a,isMutating:t.isPending||i.isPending}},Be=s=>{const{append:a}=N(),{trigger:r}=L();return e.jsxs(g,{variant:"outline",onClick:async()=>{const n=`columns.${s.lastIndex}.title`;await r([n])&&a({})},children:[e.jsx(V,{}),"Add"]})},Oe=s=>{const{append:a}=N(),{trigger:r}=L();return e.jsxs(g,{variant:"outline",onClick:async()=>{const n=`project_access.${s.lastIndex}.user`,t=`project_access.${s.lastIndex}.role`;await r([n,t])&&a({})},children:[e.jsx(V,{}),"Add"]})};var k="Radio",[Te,W]=K(k),[Ue,Le]=Te(k),X=m.forwardRef((s,a)=>{const{__scopeRadio:r,name:n,checked:t=!1,required:i,disabled:u,value:c="on",onCheck:d,form:l,...o}=s,[p,h]=m.useState(null),x=$(a,f=>h(f)),j=m.useRef(!1),v=p?l||!!p.closest("form"):!0;return e.jsxs(Ue,{scope:r,checked:t,disabled:u,children:[e.jsx(S.button,{type:"button",role:"radio","aria-checked":t,"data-state":Z(t),"data-disabled":u?"":void 0,disabled:u,value:c,...o,ref:x,onClick:I(s.onClick,f=>{t||d==null||d(),v&&(j.current=f.isPropagationStopped(),j.current||f.stopPropagation())})}),v&&e.jsx(Ve,{control:p,bubbles:!j.current,name:n,value:c,checked:t,required:i,disabled:u,form:l,style:{transform:"translateX(-100%)"}})]})});X.displayName=k;var Y="RadioIndicator",J=m.forwardRef((s,a)=>{const{__scopeRadio:r,forceMount:n,...t}=s,i=Le(Y,r);return e.jsx(ve,{present:n||i.checked,children:e.jsx(S.span,{"data-state":Z(i.checked),"data-disabled":i.disabled?"":void 0,...t,ref:a})})});J.displayName=Y;var Ve=s=>{const{control:a,checked:r,bubbles:n=!0,...t}=s,i=m.useRef(null),u=fe(r),c=ge(a);return m.useEffect(()=>{const d=i.current,l=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(l,"checked").set;if(u!==r&&p){const h=new Event("click",{bubbles:n});p.call(d,r),d.dispatchEvent(h)}},[u,r,n]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:r,...t,tabIndex:-1,ref:i,style:{...s.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Z(s){return s?"checked":"unchecked"}var Ke=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],P="RadioGroup",[$e,cs]=K(P,[z,W]),ee=z(),se=W(),[ze,He]=$e(P),re=m.forwardRef((s,a)=>{const{__scopeRadioGroup:r,name:n,defaultValue:t,value:i,required:u=!1,disabled:c=!1,orientation:d,dir:l,loop:o=!0,onValueChange:p,...h}=s,x=ee(r),j=Re(l),[v,f]=Ce({prop:i,defaultProp:t,onChange:p});return e.jsx(ze,{scope:r,name:n,required:u,disabled:c,value:v,onValueChange:f,children:e.jsx(be,{asChild:!0,...x,orientation:d,dir:j,loop:o,children:e.jsx(S.div,{role:"radiogroup","aria-required":u,"aria-orientation":d,"data-disabled":c?"":void 0,dir:j,...h,ref:a})})})});re.displayName=P;var ae="RadioGroupItem",ne=m.forwardRef((s,a)=>{const{__scopeRadioGroup:r,disabled:n,...t}=s,i=He(ae,r),u=i.disabled||n,c=ee(r),d=se(r),l=m.useRef(null),o=$(a,l),p=i.value===t.value,h=m.useRef(!1);return m.useEffect(()=>{const x=v=>{Ke.includes(v.key)&&(h.current=!0)},j=()=>h.current=!1;return document.addEventListener("keydown",x),document.addEventListener("keyup",j),()=>{document.removeEventListener("keydown",x),document.removeEventListener("keyup",j)}},[]),e.jsx(ye,{asChild:!0,...c,focusable:!u,active:p,children:e.jsx(X,{disabled:u,required:i.required,checked:p,...d,...t,name:i.name,ref:o,onCheck:()=>i.onValueChange(t.value),onKeyDown:I(x=>{x.key==="Enter"&&x.preventDefault()}),onFocus:I(t.onFocus,()=>{var x;h.current&&((x=l.current)==null||x.click())})})})});ne.displayName=ae;var Qe="RadioGroupIndicator",oe=m.forwardRef((s,a)=>{const{__scopeRadioGroup:r,...n}=s,t=se(r);return e.jsx(J,{...t,...n,ref:a})});oe.displayName=Qe;var te=re,ce=ne,We=oe;const ie=m.forwardRef(({className:s,...a},r)=>e.jsx(te,{className:H("grid gap-2",s),...a,ref:r}));ie.displayName=te.displayName;const w=m.forwardRef(({className:s,...a},r)=>e.jsx(ce,{ref:r,className:H("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(We,{className:"flex items-center justify-center",children:e.jsx(Ne,{className:"h-3.5 w-3.5 fill-primary"})})}));w.displayName=ce.displayName;const Xe=()=>e.jsx(R,{name:"board_access",render:({field:s})=>e.jsxs(ie,{value:s.value,onValueChange:s.onChange,children:[e.jsx("div",{className:"text font-bold",children:"Access"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"open",id:"open"}),e.jsxs(A,{className:"flex items-center gap-x-2",htmlFor:"open",children:[e.jsx(Ae,{className:"h-[1.25rem] w-[1.25rem]"}),"Open"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"private",id:"private"}),e.jsxs(A,{className:"flex items-center gap-x-2",htmlFor:"private",children:[e.jsx(Ee,{className:"h-[1.25rem] w-[1.25rem]"}),"Private"]})]})]})}),Ye=s=>e.jsx(R,{name:s.name,rules:{required:"Column name is required"},render:({field:a,fieldState:r})=>{var n;return e.jsx(F,{value:a.value,onChange:a.onChange,placeholder:"Column name...",error:(n=r.error)==null?void 0:n.message})}}),Je=()=>e.jsx(R,{name:"description",render:({field:s})=>e.jsx("div",{className:"grid gap-2",children:e.jsx(F,{id:"description",type:"text",label:"Description",placeholder:"Description",required:!0,...s})})}),Ze=()=>e.jsx(R,{name:"title",rules:{required:"Title is required"},render:({field:s,fieldState:a})=>{var r;return e.jsx(F,{type:"text",placeholder:"Title",label:"Title",required:!0,...s,error:(r=a.error)==null?void 0:r.message})}}),es=m.memo(Ze),ss=s=>{const{remove:a}=N();return s.isSingle?null:e.jsx(g,{size:"sm",variant:"link",onClick:()=>a(s.index),children:"Remove"})},rs=s=>{const{remove:a}=N();return s.isSingle?null:e.jsx(g,{size:"sm",variant:"link",onClick:()=>a(s.index),children:"Remove"})},as=s=>!!Ie({name:s.formUserName})&&e.jsx(R,{name:s.name,rules:{required:"Role is required"},render:({field:r,fieldState:n})=>{var t;return e.jsx(qe,{value:r.value,onChange:r.onChange,error:(t=n.error)==null?void 0:t.message})}}),ns=s=>e.jsx(R,{name:s.name,rules:{required:"User is required"},render:({field:a,fieldState:r})=>{var n;return e.jsx(we,{value:a.value,onChange:a.onChange,error:(n=r.error)==null?void 0:n.message})}}),is=()=>{const a=!!U(),{methodsForm:r,isPending:n,onSubmit:t,isMutating:i,closeButtonRef:u}=De();return e.jsxs(Se,{...r,children:[e.jsxs(Fe,{className:"grid gap-6",children:[a&&n&&Array.from({length:8},(c,d)=>e.jsx(T,{className:"h-[3.5rem] w-full"},d)),(a?!n:!0)&&e.jsxs(e.Fragment,{children:[e.jsx(es,{}),e.jsx(Je,{}),e.jsx(Xe,{}),e.jsx(B,{name:"project_access",children:({fields:c})=>e.jsxs("div",{children:[e.jsx(E,{className:"mb-2 h-auto p-0 shadow-[none]",children:e.jsxs(M,{children:[e.jsxs(G,{children:[e.jsx(C,{className:"w-[50%]",children:"Name"}),e.jsx(C,{className:"w-[50%]",children:"Role"}),e.jsx(C,{className:"min-w-[5rem]"})]}),e.jsx(q,{children:c.map((d,l)=>{const o=`project_access.${l}.user`,p=`project_access.${l}.role`,h=c.length===1;return e.jsxs(D,{id:d.id,children:[e.jsx(b,{children:e.jsx(ns,{name:o})}),e.jsx(b,{children:e.jsx(as,{name:p,formUserName:o})}),e.jsx(b,{children:e.jsx(rs,{index:l,isSingle:h})})]},d.id)})})]})}),e.jsx(Oe,{lastIndex:c.length-1})]})}),e.jsx(B,{name:"columns",children:({fields:c})=>e.jsxs("div",{children:[e.jsx("div",{className:"text font-bold",children:"Columns"}),e.jsx(E,{className:"mb-2 h-auto p-0 shadow-[none]",children:e.jsxs(M,{children:[e.jsxs(G,{children:[e.jsx(C,{className:"w-full",children:"Column name"}),e.jsx(C,{className:"min-w-[5rem]"})]}),e.jsx(q,{children:c.map((d,l)=>{const o=`columns.${l}.title`,p=c.length===1;return e.jsxs(D,{id:d.id,children:[e.jsx(b,{children:e.jsx(Ye,{name:o})}),e.jsx(b,{children:e.jsx(ss,{index:l,isSingle:p})})]},d.id)})})]})}),e.jsx(Be,{lastIndex:c.length-1})]})})]})]}),e.jsxs(ke,{children:[e.jsxs(g,{disabled:i,onClick:r.handleSubmit(t),children:[i&&e.jsx(Pe,{className:"stroke-white"}),a?"Update":"Create"]}),e.jsx(_e,{asChild:!0,ref:u,children:e.jsx(g,{variant:"outline",children:"Cancel"})})]})]})};export{is as default};
